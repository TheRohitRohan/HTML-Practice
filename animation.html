<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crazy Canvas Animation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #0b1020, #000);
      overflow: hidden;
      height: 100%;
      font-family: system-ui, sans-serif;
    }

    #hud {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      color: #9ff;
      opacity: 0.85;
      font-size: 14px;
      background: rgba(0,0,0,0.35);
      padding: 10px 14px;
      border-radius: 14px;
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 30px rgba(0,255,255,0.15);
    }

    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div id="hud">ðŸŒ€ Move mouse / touch Â· Click = shockwave Â· Keys: [C]olor mode Â· [R]eset</div>

  <script>
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');

    let w, h, dpr;

    function resize() {
      dpr = window.devicePixelRatio || 1;
      w = window.innerWidth;
      h = window.innerHeight;
      canvas.width = w * dpr;
      canvas.height = h * dpr;
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }

    window.addEventListener('resize', resize);
    resize();

    // ---- Utilities ----
    const rand = (a, b) => Math.random() * (b - a) + a;

    // Simple 2D value noise
    const noise = (() => {
      const perm = new Uint8Array(512);
      for (let i = 0; i < 256; i++) perm[i] = i;
      for (let i = 255; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [perm[i], perm[j]] = [perm[j], perm[i]];
      }
      for (let i = 0; i < 256; i++) perm[i + 256] = perm[i];

      const fade = t => t * t * t * (t * (t * 6 - 15) + 10);
      const lerp = (a, b, t) => a + (b - a) * t;
      const grad = (hash, x, y) => {
        const h = hash & 3;
        return (h === 0 ? x : h === 1 ? -x : h === 2 ? y : -y);
      };

      return function(x, y) {
        const X = Math.floor(x) & 255;
        const Y = Math.floor(y) & 255;
        x -= Math.floor(x);
        y -= Math.floor(y);
        const u = fade(x);
        const v = fade(y);

        const aa = perm[X + perm[Y]];
        const ab = perm[X + perm[Y + 1]];
        const ba = perm[X + 1 + perm[Y]];
        const bb = perm[X + 1 + perm[Y + 1]];

        return lerp(
          lerp(grad(aa, x, y), grad(ba, x - 1, y), u),
          lerp(grad(ab, x, y - 1), grad(bb, x - 1, y - 1), u),
          v
        );
      };
    })();

    // ---- Flow Field ----
    const flowScale = 0.0015;
    let time = 0;

    // ---- Interaction ----
    const mouse = { x: w / 2, y: h / 2, down: false };

    window.addEventListener('mousemove', e => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });

    window.addEventListener('touchmove', e => {
      const t = e.touches[0];
      mouse.x = t.clientX;
      mouse.y = t.clientY;
    }, { passive: true });

    window.addEventListener('mousedown', () => shockwave(mouse.x, mouse.y));
    window.addEventListener('touchstart', e => {
      const t = e.touches[0];
      shockwave(t.clientX, t.clientY);
    });

    // ---- Particles ----
    const COUNT = 2200;
    let particles = [];

    class Particle {
      constructor() {
        this.reset();
      }

      reset() {
        this.x = rand(0, w);
        this.y = rand(0, h);
        this.vx = 0;
        this.vy = 0;
        this.life = rand(200, 1200);
        this.size = rand(0.4, 1.6);
        this.hue = rand(0, 360);
      }

      step() {
        const nx = this.x * flowScale;
        const ny = this.y * flowScale;
        const a = noise(nx + time, ny + time) * Math.PI * 2;

        const mx = this.x - mouse.x;
        const my = this.y - mouse.y;
        const md = Math.sqrt(mx * mx + my * my) + 0.0001;
        const pull = Math.min(90 / md, 2.5);

        const ax = Math.cos(a) + (-mx / md) * pull;
        const ay = Math.sin(a) + (-my / md) * pull;

        this.vx += ax * 0.15;
        this.vy += ay * 0.15;

        this.vx *= 0.96;
        this.vy *= 0.96;

        this.x += this.vx;
        this.y += this.vy;

        if (this.x < 0) this.x += w;
        if (this.x > w) this.x -= w;
        if (this.y < 0) this.y += h;
        if (this.y > h) this.y -= h;

        this.life--;
        if (this.life <= 0) this.reset();
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fillStyle = colorMode
          ? `hsla(${this.hue}, 90%, 60%, 0.6)`
          : 'rgba(150,255,255,0.5)';
        ctx.fill();
      }
    }

    function init() {
      particles = [];
      for (let i = 0; i < COUNT; i++) particles.push(new Particle());
    }

    init();

    // ---- Shockwaves ----
    const waves = [];

    function shockwave(x, y) {
      waves.push({ x, y, r: 0, a: 1 });
    }

    // ---- Controls ----
    let colorMode = true;

    window.addEventListener('keydown', e => {
      if (e.key.toLowerCase() === 'c') colorMode = !colorMode;
      if (e.key.toLowerCase() === 'r') init();
    });

    // ---- Animation Loop ----
    function loop() {
      time += 0.0006;

      ctx.fillStyle = 'rgba(0,0,0,0.18)';
      ctx.fillRect(0, 0, w, h);

      for (const p of particles) {
        p.step();
        p.draw();
      }

      for (let i = waves.length - 1; i >= 0; i--) {
        const wave = waves[i];
        wave.r += 8;
        wave.a *= 0.95;

        ctx.beginPath();
        ctx.arc(wave.x, wave.y, wave.r, 0, Math.PI * 2);
        ctx.strokeStyle = `rgba(180,255,255,${wave.a})`;
        ctx.lineWidth = 2;
        ctx.stroke();

        if (wave.a < 0.05) waves.splice(i, 1);
      }

      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>
